<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Pasantías Rentadas</title>
    <!-- Incluyendo Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        /* Estilos personalizados para el Funnel Chart y la base de los gráficos */
        .chart-base {
            height: 200px;
            display: flex;
            align-items: flex-end;
            padding-bottom: 5px;
            border-bottom: 1px solid #e5e7eb;
        }
        .bar { transition: height 0.5s ease-out; }
        
        .funnel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        .funnel-segment {
            width: 100%;
            height: 40px;
            background-color: #4f46e5;
            margin-bottom: 8px;
            clip-path: polygon(0% 0%, 100% 0%, 95% 100%, 5% 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: 600;
            position: relative;
        }
        .funnel-segment::after {
            content: attr(data-drop);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 2px;
            font-size: 0.75rem;
            color: #4b5563;
        }

        /* Estilo para el hover de las pestañas */
        .tab-button:hover {
            color: #4f46e5;
            border-color: #a5b4fc;
        }
        .tab-button.active {
            border-color: #4f46e5;
            color: #4f46e5;
            font-weight: 700;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Dashboard de Pasantías Rentadas</h1>
        <p class="text-gray-500 mt-1">Ciclo: <span id="current-cycle"></span> | Cobertura Total: <span id="total-interns"></span> Pasantes</p>
    </header>

    <!-- Navegación por Pestañas -->
    <nav class="border-b border-gray-200 mb-6">
        <div class="flex space-x-4">
            <button id="tab-resumen" class="tab-button active pb-2 border-b-2 border-indigo-600 text-indigo-600 focus:outline-none">Resumen Ejecutivo</button>
            <button id="tab-desempeno" class="tab-button pb-2 border-b-2 border-transparent text-gray-500 focus:outline-none">Desempeño y Calidad</button>
            <button id="tab-diversidad" class="tab-button pb-2 border-b-2 border-transparent text-gray-500 focus:outline-none">Diversidad y Fuente</button>
        </div>
    </nav>

    <!-- Contenido del Dashboard -->
    <main class="grid grid-cols-1 gap-6">
        
        <!-- Pestaña 1: Resumen Ejecutivo -->
        <section id="content-resumen" class="tab-content">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">1. Resumen Ejecutivo (KPIs y Funnel)</h2>
            
            <!-- KPIs Principales (Scorecards) -->
            <div id="kpis-summary" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Se llenará con JS -->
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Gráfico de Embudo de Contratación -->
                <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-1">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Embudo de Contratación</h3>
                    <div id="funnel-chart" class="funnel-container">
                        <!-- Se llenará con JS -->
                    </div>
                </div>

                <!-- Evolución Histórica / Tasa de Conversión -->
                <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-2">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Evolución Histórica de Conversión (%)</h3>
                    <div id="historical-chart" class="chart-base h-64 relative">
                        <!-- Se llenará con JS -->
                    </div>
                    <div class="flex justify-between text-sm mt-2 text-gray-500" id="historical-labels">
                        <!-- Etiquetas de año -->
                    </div>
                </div>

                <!-- Distribución por Departamento -->
                <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-3">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Distribución por Departamento y Tasa de Conversión</h3>
                    <div id="department-distribution" class="chart-base h-56 flex items-end pt-4">
                        <!-- Se llenará con JS -->
                    </div>
                </div>

            </div>
        </section>

        <!-- Pestaña 2: Desempeño y Calidad -->
        <section id="content-desempeno" class="tab-content hidden">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">2. Desempeño y Calidad</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Resultados de Evaluación (Histograma) -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Distribución de Puntuaciones de Evaluación (1-5)</h3>
                    <div id="evaluation-histogram" class="chart-base h-64 pt-4">
                        <!-- Se llenará con JS -->
                    </div>
                </div>
                
                <!-- Satisfacción del Supervisor -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Satisfacción Promedio del Supervisor (1-5)</h3>
                    <div id="supervisor-satisfaction" class="flex flex-col space-y-4 pt-4">
                        <!-- Se llenará con JS -->
                    </div>
                </div>
                
                <!-- Feedback Cualitativo/Proyectos (Tabla) -->
                <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-2">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Proyectos Clave Finalizados</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pasante</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Proyecto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Impacto/Calificación</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table" class="bg-white divide-y divide-gray-200">
                                <!-- Se llenará con JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pestaña 3: Diversidad y Fuente -->
        <section id="content-diversidad" class="tab-content hidden">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">3. Diversidad y Fuente de Talento</h2>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Desglose Demográfico (Género y Etnia) -->
                <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-1">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Composición de Género</h3>
                    <div id="gender-donut" class="flex justify-center h-48">
                         <!-- Se llenará con JS (Donut Chart simple) -->
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-2">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Rendimiento por Origen Académico (Simulado)</h3>
                    <div id="origin-performance" class="chart-base h-48 pt-4">
                        <!-- Se llenará con JS -->
                    </div>
                </div>
                
                <!-- Desglose de Conversión por Género (Barra Apilada 100%) -->
                <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-3">
                    <h3 class="font-bold text-lg mb-4 text-gray-700">Tasa de Conversión General Segmentada por Género</h3>
                    <div id="conversion-by-gender" class="flex flex-col items-center pt-4">
                        <div class="text-sm font-semibold mb-2 text-gray-600">Tasa de Conversión Total: <span id="conversion-rate-total"></span></div>
                        <div class="w-full h-8 flex rounded-lg overflow-hidden shadow-inner" id="stacked-bar">
                             <!-- Se llenará con JS -->
                        </div>
                        <div class="flex justify-around w-full text-xs mt-2 text-gray-500">
                            <p class="text-blue-500">Mujeres: <span id="conv-women-rate"></span></p>
                            <p class="text-green-500">Hombres: <span id="conv-men-rate"></span></p>
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <script>
        // Datos Simulados
        const simulationData = {
            currentCycle: "2024 - Otoño",
            totalInterns: 78,
            offersMade: 18,
            offersAccepted: 15,
            eligibleForConversion: 25,
            retention1Year: 0.85, 
            avgEvaluationScore: 4.2, 
            previousConversionRate: 0.55, // 55% del ciclo anterior
            currentConversionRate: 15 / 25, // 60%

            funnel: [
                { stage: "Solicitudes", count: 1200, color: "bg-indigo-700" },
                { stage: "Revisión CV", count: 450, color: "bg-indigo-600" },
                { stage: "Entrevistas 1", count: 150, color: "bg-indigo-500" },
                { stage: "Entrevistas Finales", count: 30, color: "bg-indigo-400" },
                { stage: "Ofertas", count: 18, color: "bg-indigo-300" },
                { stage: "Contratados", count: 15, color: "bg-indigo-200" }
            ],

            departmentDistribution: [
                { dept: "Ingeniería", count: 35, conversion: 0.65 },
                { dept: "Marketing", count: 15, conversion: 0.53 },
                { dept: "Finanzas", count: 10, conversion: 0.70 },
                { dept: "RR.HH.", count: 8, conversion: 0.45 },
                { dept: "Operaciones", count: 10, conversion: 0.60 }
            ],

            evaluationScores: [
                { range: "5.0 (Exc.)", count: 5, color: "bg-green-600" },
                { range: "4.0 - 4.9 (Sobresaliente)", count: 45, color: "bg-green-500" },
                { range: "3.0 - 3.9 (Cumple)", count: 20, color: "bg-yellow-500" },
                { range: "2.0 - 2.9 (Mejora)", count: 8, color: "bg-red-500" },
            ],

            supervisorSatisfaction: [
                { supervisor: "Elena Ríos", score: 4.7, count: 8, color: "bg-indigo-500" },
                { supervisor: "Carlos Luna", score: 3.9, count: 12, color: "bg-indigo-500" },
                { supervisor: "Sofía Gómez", score: 4.5, count: 10, color: "bg-indigo-500" },
                { supervisor: "Javier Velez", score: 4.1, count: 15, color: "bg-indigo-500" },
            ],

            historicalConversion: [
                { year: 2021, conversion: 0.40, completion: 0.75 },
                { year: 2022, conversion: 0.48, completion: 0.82 },
                { year: 2023, conversion: 0.55, completion: 0.90 },
                { year: 2024, conversion: 0.60, completion: 0.95 }
            ],

            projects: [
                { intern: "Ana Pérez", project: "Optimización de Algoritmo de Carga", impact: "Alto", rating: 5.0 },
                { intern: "Luis Rojas", project: "Campaña de Email Marketing V2", impact: "Medio", rating: 4.2 },
                { intern: "Marta Díaz", project: "Análisis de Flujo de Caja Q3", impact: "Alto", rating: 4.8 },
                { intern: "Juan Soto", project: "Documentación de APIs Internas", impact: "Medio-Bajo", rating: 3.5 },
            ],
            
            demographics: {
                gender: [
                    { label: "Mujeres", percentage: 48, color: "bg-blue-500" },
                    { label: "Hombres", percentage: 45, color: "bg-green-500" },
                    { label: "Otro/No especificado", percentage: 7, color: "bg-gray-400" }
                ],
                conversionByGender: {
                    women: { totalInterns: 12, converted: 7, rate: 7/12 }, // 58.3%
                    men: { totalInterns: 13, converted: 8, rate: 8/13 },   // 61.5%
                }
            },

            originPerformance: [
                { origin: "U. Nacional de Ingeniería", score: 4.5, conversion: 0.75 },
                { origin: "I.T. de Buenos Aires", score: 4.2, conversion: 0.60 },
                { origin: "U. Privada del Sur", score: 3.8, conversion: 0.45 },
                { origin: "Programa de Referidos", score: 4.3, conversion: 0.68 },
            ]
        };

        // --- Funciones de Utilidad ---
        const formatPercent = (value) => `${(value * 100).toFixed(1)}%`;
        const calculateTrend = (current, previous) => {
            const diff = current - previous;
            const percentageChange = (diff / previous) * 100;
            const icon = diff > 0 ? '?' : (diff < 0 ? '?' : '?');
            const color = diff > 0 ? 'text-green-500' : (diff < 0 ? 'text-red-500' : 'text-gray-500');
            return `<span class="${color} text-sm font-medium">${icon} ${Math.abs(percentageChange).toFixed(1)}%</span>`;
        };

        // --- Funciones de Renderizado ---

        function renderGeneralInfo() {
            document.getElementById('current-cycle').textContent = simulationData.currentCycle;
            document.getElementById('total-interns').textContent = simulationData.totalInterns;
        }

        function renderKPIs() {
            const container = document.getElementById('kpis-summary');
            container.innerHTML = '';
            
            const conversionTrend = calculateTrend(simulationData.currentConversionRate, simulationData.previousConversionRate);

            const kpiData = [
                { title: "Tasa de Conversión", value: formatPercent(simulationData.currentConversionRate), trend: conversionTrend, icon: "??", color: "text-indigo-600" },
                { title: "Puntuación de Evaluación Promedio", value: simulationData.avgEvaluationScore.toFixed(2) + " / 5", trend: "", icon: "?", color: "text-yellow-600" },
                { title: "Retención Post-Pasantía (1 Año)", value: formatPercent(simulationData.retention1Year), trend: "", icon: "??", color: "text-teal-600" },
                { title: "Pasantes Contratados", value: simulationData.offersAccepted, trend: "", icon: "??", color: "text-blue-600" },
            ];

            kpiData.forEach(kpi => {
                const card = `
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-600">
                        <div class="flex justify-between items-start">
                            <p class="text-sm font-medium text-gray-500">${kpi.title}</p>
                            <span class="text-2xl">${kpi.icon}</span>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 mt-1">${kpi.value}</p>
                        <div class="mt-2 text-xs">${kpi.trend}</div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        function renderFunnel() {
            const container = document.getElementById('funnel-chart');
            container.innerHTML = '';
            
            const maxCount = simulationData.funnel[0].count;
            let previousCount = maxCount;

            // Se invierte el orden para dibujar de abajo (más pequeño) a arriba (más grande)
            const reversedFunnel = [...simulationData.funnel].reverse();

            reversedFunnel.forEach((step, index) => {
                const widthPercentage = (step.count / maxCount) * 100;
                
                let dropRate = '';
                if (index < reversedFunnel.length - 1) {
                    const drop = previousCount - step.count;
                    const dropPercent = (drop / previousCount) * 100;
                    dropRate = `Pérdida: ${drop} (${dropPercent.toFixed(1)}%)`;
                }
                
                const segment = `
                    <div class="funnel-segment" style="width: ${widthPercentage.toFixed(2)}%; background-color: ${step.color.replace('bg-', '#').replace('-700', '4f46e5')};" data-drop="${dropRate}">
                        ${step.stage}: ${step.count}
                    </div>
                `;
                container.innerHTML = segment + container.innerHTML; // Prepending to reverse the order back
                previousCount = step.count;
            });
        }

        function renderHistoricalChart() {
            const container = document.getElementById('historical-chart');
            const labelsContainer = document.getElementById('historical-labels');
            container.innerHTML = '';
            labelsContainer.innerHTML = '';

            const maxConversion = 0.95; // Escala máxima para los porcentajes (95%)
            
            simulationData.historicalConversion.forEach(data => {
                const heightConversion = (data.conversion / maxConversion) * 100;
                const heightCompletion = (data.completion / maxConversion) * 100;

                const barGroup = document.createElement('div');
                barGroup.className = 'flex flex-col justify-end items-center w-1/4 h-full relative group';
                barGroup.innerHTML = `
                    <!-- Puntos de Datos -->
                    <div class="w-full h-full relative flex items-end justify-center">
                        <!-- Tasa de Conversión (Línea 1) -->
                        <div style="height: ${heightConversion}%;" class="w-1/2 bg-indigo-400 rounded-t bar absolute bottom-0 left-0 hover:bg-indigo-600 transition-colors">
                            <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-700 text-white text-xs px-2 py-1 rounded hidden group-hover:block whitespace-nowrap">
                                Conv: ${formatPercent(data.conversion)}
                            </span>
                        </div>
                        <!-- Tasa de Finalización Exitosa (Línea 2) -->
                        <div style="height: ${heightCompletion}%;" class="w-1/2 bg-green-400 rounded-t bar absolute bottom-0 right-0 hover:bg-green-600 transition-colors">
                            <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-700 text-white text-xs px-2 py-1 rounded hidden group-hover:block whitespace-nowrap">
                                Finaliz: ${formatPercent(data.completion)}
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(barGroup);
                
                // Etiquetas de año
                labelsContainer.innerHTML += `<span class="w-1/4 text-center font-semibold">${data.year}</span>`;
            });
             // Leyenda
             container.innerHTML += `
                <div class="absolute top-0 right-0 p-2 text-xs bg-white rounded-lg shadow">
                    <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-indigo-400 mr-2"></span>Tasa de Conversión</div>
                    <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-green-400 mr-2"></span>Tasa de Finalización</div>
                </div>
            `;
        }
        
        function renderDepartmentDistribution() {
            const container = document.getElementById('department-distribution');
            container.innerHTML = '';
            
            const maxCount = Math.max(...simulationData.departmentDistribution.map(d => d.count));

            simulationData.departmentDistribution.forEach((data, index) => {
                const heightPercentage = (data.count / maxCount) * 100;
                const color = ['#6366f1', '#34d399', '#f59e0b', '#ef4444', '#06b6d4'][index % 5];
                
                const barGroup = `
                    <div class="flex flex-col items-center w-1/5 h-full px-2 group cursor-pointer">
                        <div style="height: ${heightPercentage}%; background-color: ${color};" 
                             class="bar w-full rounded-t-lg relative transition-all duration-300 ease-in-out hover:opacity-80">
                            <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                ${data.dept}: ${data.count} Pasantes (${formatPercent(data.conversion)} Conversión)
                            </span>
                        </div>
                        <p class="text-xs text-gray-600 mt-1 truncate w-full text-center">${data.dept}</p>
                    </div>
                `;
                container.innerHTML += barGroup;
            });
        }

        function renderEvaluationHistogram() {
            const container = document.getElementById('evaluation-histogram');
            container.innerHTML = '';
            
            const maxCount = Math.max(...simulationData.evaluationScores.map(d => d.count));

            simulationData.evaluationScores.forEach((data, index) => {
                const heightPercentage = (data.count / maxCount) * 100;
                
                const barGroup = `
                    <div class="flex flex-col justify-end items-center w-1/4 h-full px-2 group">
                        <div style="height: ${heightPercentage}%;" 
                             class="bar w-full ${data.color} rounded-t-lg relative transition-all duration-300 ease-in-out">
                            <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                ${data.count} Pasantes
                            </span>
                        </div>
                        <p class="text-xs text-gray-600 mt-1 text-center">${data.range}</p>
                    </div>
                `;
                container.innerHTML += barGroup;
            });
        }

        function renderSupervisorSatisfaction() {
            const container = document.getElementById('supervisor-satisfaction');
            container.innerHTML = '';
            
            const maxScore = 5.0;

            simulationData.supervisorSatisfaction.forEach(data => {
                const widthPercentage = (data.score / maxScore) * 100;
                
                const barHtml = `
                    <div class="flex items-center">
                        <span class="w-1/3 text-sm text-gray-600">${data.supervisor} (${data.count} Pasantes)</span>
                        <div class="w-2/3 h-6 bg-gray-200 rounded-full ml-4 relative">
                            <div style="width: ${widthPercentage}%;" class="h-full bg-indigo-500 rounded-full transition-all duration-500"></div>
                            <span class="absolute right-0 top-0 h-full flex items-center pr-2 font-bold text-white text-sm">${data.score.toFixed(1)}</span>
                        </div>
                    </div>
                `;
                container.innerHTML += barHtml;
            });
        }
        
        function renderProjectsTable() {
            const tbody = document.getElementById('projects-table');
            tbody.innerHTML = '';

            simulationData.projects.forEach(project => {
                let color;
                if (project.impact === 'Alto') color = 'bg-green-100 text-green-800';
                else if (project.impact === 'Medio') color = 'bg-yellow-100 text-yellow-800';
                else color = 'bg-red-100 text-red-800';

                const row = `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${project.intern}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${project.project}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${color}">${project.impact}</span>
                            <span class="text-xs text-gray-500 ml-2">(${project.rating.toFixed(1)}/5)</span>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderGenderDonut() {
            const container = document.getElementById('gender-donut');
            container.innerHTML = '';

            // Dibujo de Donut Chart simple usando CSS con gradientes (solo para visualización simple)
            const women = simulationData.demographics.gender.find(g => g.label === 'Mujeres').percentage;
            const men = simulationData.demographics.gender.find(g => g.label === 'Hombres').percentage;
            const other = simulationData.demographics.gender.find(g => g.label.startsWith('Otro')).percentage;

            const style = `
                width: 150px;
                height: 150px;
                border-radius: 50%;
                background: conic-gradient(
                    #3b82f6 0% ${women}%, 
                    #10b981 ${women}% ${women + men}%, 
                    #9ca3af ${women + men}% 100%
                );
            `;
            
            // Leyenda
            const legend = `
                <div class="ml-8 self-center space-y-2 text-sm">
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span>Mujeres: ${women}%</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>Hombres: ${men}%</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-gray-400 mr-2"></span>Otro/No especificado: ${other}%</div>
                </div>
            `;

            container.innerHTML = `
                <div style="${style}" class="shadow-inner relative">
                    <div class="absolute inset-0 m-auto w-1/2 h-1/2 bg-white rounded-full flex items-center justify-center text-sm font-bold text-gray-700">100%</div>
                </div>
                ${legend}
            `;
        }

        function renderOriginPerformance() {
            const container = document.getElementById('origin-performance');
            container.innerHTML = '';
            
            const maxScore = 5.0; // Max score for visualization scale
            const maxConversion = 0.8; // Max conversion for visualization scale

            simulationData.originPerformance.forEach((data, index) => {
                const heightScore = (data.score / maxScore) * 100;
                const heightConversion = (data.conversion / maxConversion) * 100;
                
                const barGroup = document.createElement('div');
                barGroup.className = 'flex flex-col justify-end items-center w-1/4 h-full relative group px-2';
                
                barGroup.innerHTML = `
                    <div class="w-full h-full relative flex items-end justify-center">
                        <!-- Conversión (Línea 2) -->
                        <div style="height: ${heightConversion}%;" class="w-1/2 bg-purple-400 rounded-t bar absolute bottom-0 left-0 hover:bg-purple-600 transition-colors">
                            <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-700 text-white text-xs px-2 py-1 rounded hidden group-hover:block whitespace-nowrap">
                                Conv: ${formatPercent(data.conversion)}
                            </span>
                        </div>
                        <!-- Puntuación (Línea 1) -->
                        <div style="height: ${heightScore}%;" class="w-1/2 bg-yellow-400 rounded-t bar absolute bottom-0 right-0 hover:bg-yellow-600 transition-colors">
                            <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-700 text-white text-xs px-2 py-1 rounded hidden group-hover:block whitespace-nowrap">
                                Score: ${data.score.toFixed(1)}/5
                            </span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-1 text-center truncate w-full">${data.origin.split(' ')[0]}</p>
                `;
                container.appendChild(barGroup);
            });

             // Leyenda
             container.innerHTML += `
                <div class="absolute top-0 right-0 p-2 text-xs bg-white rounded-lg shadow">
                    <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-yellow-400 mr-2"></span>Score Promedio</div>
                    <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-purple-400 mr-2"></span>Tasa de Conversión</div>
                </div>
            `;
        }
        
        function renderConversionByGender() {
            const { women, men } = simulationData.demographics.conversionByGender;
            const stackedBar = document.getElementById('stacked-bar');
            
            const totalConverted = women.converted + men.converted;
            const totalEligible = women.totalInterns + men.totalInterns;
            const conversionRateTotal = totalConverted / totalEligible;

            // Porcentaje de la barra total que ocupa cada grupo (dentro del 100% de la barra)
            // Calculamos cuánto representa la conversión de cada género sobre el total de pasantes (totalEligible)
            const womenWidth = (women.converted / totalEligible) * 100;
            const menWidth = (men.converted / totalEligible) * 100;
            const unconvertedWidth = 100 - (womenWidth + menWidth); // La diferencia son los no convertidos.

            stackedBar.innerHTML = `
                <div style="width: ${womenWidth.toFixed(2)}%;" class="bg-blue-500 h-full flex justify-center items-center text-white text-xs font-semibold px-2 hover:opacity-80 transition-opacity cursor-help" title="Mujeres Contratadas: ${women.converted}">
                    ${women.converted}
                </div>
                <div style="width: ${menWidth.toFixed(2)}%;" class="bg-green-500 h-full flex justify-center items-center text-white text-xs font-semibold px-2 hover:opacity-80 transition-opacity cursor-help" title="Hombres Contratados: ${men.converted}">
                    ${men.converted}
                </div>
                <div style="width: ${unconvertedWidth.toFixed(2)}%;" class="bg-gray-300 h-full flex justify-center items-center text-gray-700 text-xs px-2 hover:opacity-80 transition-opacity cursor-help" title="No Contratados: ${totalEligible - totalConverted}">
                    ${totalEligible - totalConverted}
                </div>
            `;
            
            document.getElementById('conversion-rate-total').textContent = formatPercent(conversionRateTotal);
            document.getElementById('conv-women-rate').textContent = formatPercent(women.rate);
            document.getElementById('conv-men-rate').textContent = formatPercent(men.rate);
        }

        // --- Funciones de Control de UI ---

        function setupTabs() {
            const tabs = document.querySelectorAll('.tab-button');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.id.replace('tab-', 'content-');
                    
                    // Ocultar todos los contenidos y desactivar pestañas
                    contents.forEach(content => content.classList.add('hidden'));
                    tabs.forEach(t => t.classList.remove('active', 'border-indigo-600', 'text-indigo-600'));
                    tabs.forEach(t => t.classList.add('border-transparent', 'text-gray-500'));

                    // Mostrar el contenido objetivo y activar la pestaña
                    document.getElementById(targetId).classList.remove('hidden');
                    tab.classList.add('active', 'border-indigo-600', 'text-indigo-600');
                    tab.classList.remove('border-transparent', 'text-gray-500');

                    // Llama a las funciones de renderizado específicas si es necesario (para asegurar que se dibujen)
                    // Aunque los datos se cargan en init, es buena práctica si el contenido fuera dinámico.
                });
            });
        }
        
        // --- Inicialización ---

        function initializeDashboard() {
            renderGeneralInfo();
            renderKPIs();
            renderFunnel();
            renderHistoricalChart();
            renderDepartmentDistribution();
            
            renderEvaluationHistogram();
            renderSupervisorSatisfaction();
            renderProjectsTable();

            renderGenderDonut();
            renderOriginPerformance();
            renderConversionByGender();

            setupTabs();
        }

        window.onload = initializeDashboard;

    </script>
</body>
</html>